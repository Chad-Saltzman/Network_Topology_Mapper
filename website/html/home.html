<!--
Name: Gavin Claire
Document: home.html
Decription: HTML for the home page.
-->

{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <!-- CSS -->
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body>

    {% include 'navbar.html' %}
    
    <section class="home">
        <div class="container">

            <div class="logo">
                <img src="{% static 'images/logo.png' %}" alt="NetDiscover Logo">
            </div>

            <div id="main">

                <div class="text">
                    <h5> Welcome to </h5>
                    <h1> NetDiscover </h1>
                    <p> To get started, <br> please select one of the following: </p>

                    <div>
                        <button id ="scanbutton" class="largeButton" onclick="hide('main'); show('scanMenu')">Scan Local Network</button>
                    </div>
                    <div>
                        <a class="smallButton" href="{% url 'upload' %}">Open Previously Scanned Network</a>
                    </div>
                </div>
            </div>

            <div id="scanMenu">
                <div class="text">
                    <h1> Scan Local Network </h1>
                    <p> Please fill out this form with your local network's information: </p>
                </div>
                <form id="table" name="form1" action="#"> 
                    <table class="datatable" id="datatable">
                        <thead>
                            <tr>
                                <th>IP Subnet</th>
                                <th>Username</th>
                                <th>Password</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr id="row1">
                                <td id="ipsubnetRow1">0.0.0.0/0</td>
                                <td><input type="text" id="username" placeholder="computer1"></td>
                                <td><input type="text" id="password" placeholder="password123"></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td><input type="text" id="newIPsubnet" class="form-input" placeholder="xxx.xxx.xxx.xxx/xx" maxlength=18/></td>
                                <td><input type="text" id="newUsername" placeholder="steve"></td>
                                <td><input type="text" id="newPassword" placeholder="password123"></td>
                                <td><input type="button" class="addButton" onclick="addRow();" value="Add Credential"></td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="alignRight">
                        <input type="submit" value="submit" class="submitButton" id="submit" href="{% url 'inspect' %}" />
                    </div>
                </form>
            </div>
        </div>
    </section>


    <script language="javascript" type="text/javascript">
        
        // Delete row
        function deleteRow(num) {
            document.getElementById("row" + num.toString() + "").outerHTML="";
        }

        // Add row
        function addRow() {
            var newIPsubnet = document.getElementById("newIPsubnet").value;
            var newUsername = document.getElementById("newUsername").value;
            var newPassword = document.getElementById("newPassword").value;

            if (newIPsubnet != null && validateIP(newIPsubnet) && newUsername.indexOf(' ') == -1 && newPassword.indexOf(' ') == -1) {
                var table = document.getElementById("datatable");
                var tableLen = (table.rows.length) - 1;
                var row = table.insertRow(tableLen).outerHTML = "<tr id=row"+tableLen+"><td id='ipsubnet'>"+newIPsubnet+"</td><td id='username'>"+newUsername+"</td><td id='password'>"+newPassword+"</td><td><input type='button' class='deleteButton' onclick='deleteRow("+tableLen+");' value='Delete'></td></tr>";
                
                document.getElementById("newIPsubnet").value="";
                document.getElementById("newUsername").value="";
                document.getElementById("newPassword").value="";
            }
        }

        // Returns if ip address is valid
        function validateIP(ip) {
            const regexExp = /^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\/\d+$/g;
            return regexExp.test(ip);
        }

        // Hide and show elements

        // On page start hide elements
        hide('scanMenu');

        // Start local network scan
        scanButton = body.querySelector(".scanbutton");
        toggle.addEventListener("click" , () =>{
            scanButton.classList.toggle("scan");
        })

        // Hide the given element
        function hide(name) {
            document.getElementById(name).style.display = "none";
        }

        // Show the given element
        function show(name) {
            document.getElementById(name).style.display = "block";
        }

    </script>
</body>
</html>